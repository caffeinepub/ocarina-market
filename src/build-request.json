{
  "kind": "build_request",
  "title": "Fix admin image uploads that report success but do not appear in the store",
  "projectName": "Ocarina Market",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-35",
      "text": "Fix the backend bulk photo upload + item creation flow so that uploaded image bytes are actually persisted in blob storage and the created Item records reference a retrievable photo blob that can be rendered later in the storefront/admin UI.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-9"
        ],
        "quotes": [
          "images are not being uploaded to the store, even though it says successfully uploaded"
        ]
      },
      "acceptanceCriteria": [
        "Uploading one or more images via the existing admin bulk upload flow results in new Item records being added to the canister state.",
        "For each newly created Item, its photo blob can be fetched via the blob-storage mechanism (i.e., the frontend can obtain a stable direct URL and successfully load the image).",
        "If an upload cannot be persisted/retrieved, the backend call fails (traps/returns error) rather than silently creating a broken item record."
      ]
    },
    {
      "id": "REQ-36",
      "text": "Fix the backend single-item image replacement flow (admin ‘Replace Item Image’) so that the new image bytes are persisted and the item’s updated photo renders correctly after the mutation.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-9"
        ],
        "quotes": [
          "images are not being uploaded to the store, even though it says successfully uploaded"
        ]
      },
      "acceptanceCriteria": [
        "Replacing an item image from the item detail admin editor results in the new image rendering on the item detail page after refresh.",
        "After replacing an image, the item’s stable id used in URLs remains unchanged."
      ]
    },
    {
      "id": "REQ-37",
      "text": "Update the Admin Bulk Photo Upload UI to only display “Successfully uploaded” after verifying that the backend returned created item IDs and that the items can be fetched afterward; otherwise show a clear English error message and keep the user on the upload page.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-9"
        ],
        "quotes": [
          "images are not being uploaded to the store, even though it says successfully uploaded"
        ]
      },
      "acceptanceCriteria": [
        "After the bulk upload mutation resolves, the UI performs a post-upload verification step (e.g., using the returned item IDs and/or refetching items) before showing the success toast and redirecting.",
        "If verification fails, the UI shows an error toast (English) indicating the upload did not complete correctly, and does not mark all files as success.",
        "On success, React Query caches related to items/storefront are refreshed/invalidated so the newly created items appear without a hard reload."
      ]
    }
  ],
  "constraints": [
    "Backend must remain a single Motoko actor in backend/main.mo (no additional backend services).",
    "Do not edit files under frontend/src/components/ui (compose instead).",
    "Do not modify frontend immutable hook files listed in SYSTEM_CONTEXT (use existing hook APIs and add new hooks in allowed locations if needed)."
  ],
  "nonGoals": [
    "Changing the storefront publishing workflow (published/unpublished logic) beyond what is required to make images persist and render correctly.",
    "Adding new purchase/payment functionality.",
    "Changing the visual theme or branding behavior unrelated to fixing image persistence/verification."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}